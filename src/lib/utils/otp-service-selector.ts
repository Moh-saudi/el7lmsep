// مصر فقط تدعم SMS
const SMS_COUNTRIES = [
  '+20',  // مصر
];

// جميع الدول الأخرى تستخدم WhatsApp فقط
// (لا حاجة لقائمة منفصلة لأن كل الدول غير المصرية تستخدم WhatsApp)

export type OTPMethod = 'sms' | 'whatsapp';

export interface OTPServiceConfig {
  method: OTPMethod;
  serviceType?: 'business' | 'green';
  fallbackMethod?: OTPMethod;
}

/**
 * تحديد نوع OTP المناسب حسب رمز الدولة
 */
export function getOTPMethod(phoneNumber: string): OTPServiceConfig {
  // تنظيف رقم الهاتف
  let cleaned = phoneNumber.replace(/[\s\-\(\)]/g, '');
  
  // إضافة + إذا لم تكن موجودة
  if (!cleaned.startsWith('+')) {
    if (cleaned.startsWith('0')) {
      cleaned = '+2' + cleaned.substring(1);
    } else if (cleaned.length === 10) {
      cleaned = '+2' + cleaned;
    } else {
      cleaned = '+' + cleaned;
    }
  }

  // استخراج رمز الدولة (1-4 أرقام بعد +)
  const countryCode = cleaned.match(/^\+\d{1,4}/)?.[0];
  
  if (!countryCode) {
    // إذا لم نتمكن من تحديد رمز الدولة، نستخدم SMS كافتراضي
    return { method: 'sms' };
  }

  // التحقق من مصر (SMS فقط)
  if (SMS_COUNTRIES.includes(countryCode)) {
    return { 
      method: 'sms'
    };
  }

  // جميع الدول الأخرى تستخدم WhatsApp فقط
  return { 
    method: 'whatsapp',
    serviceType: 'business'
  };
}

/**
 * الحصول على اسم الدولة من رمز الدولة
 */
export function getCountryName(countryCode: string): string {
  const countryNames: { [key: string]: string } = {
    '+966': 'السعودية',
    '+971': 'الإمارات',
    '+973': 'البحرين',
    '+974': 'قطر',
    '+965': 'الكويت',
    '+968': 'عمان',
    '+967': 'اليمن',
    '+20': 'مصر',
    '+212': 'المغرب',
    '+213': 'الجزائر',
    '+216': 'تونس',
    '+218': 'ليبيا',
    '+249': 'السودان',
    '+252': 'الصومال',
    '+253': 'جيبوتي',
    '+961': 'لبنان',
    '+962': 'الأردن',
    '+963': 'سوريا',
    '+964': 'العراق',
    '+970': 'فلسطين',
    '+972': 'إسرائيل',
    '+98': 'إيران',
    '+90': 'تركيا',
    '+91': 'الهند',
    '+92': 'باكستان',
    '+880': 'بنغلاديش',
    '+94': 'سريلانكا',
    '+95': 'ميانمار',
    '+960': 'جزر المالديف',
    '+93': 'أفغانستان',
    '+992': 'طاجيكستان',
    '+993': 'تركمانستان',
    '+994': 'أذربيجان',
    '+995': 'جورجيا',
    '+996': 'قيرغيزستان',
    '+998': 'أوزبكستان',
    '+975': 'بوتان',
    '+976': 'منغوليا',
    '+977': 'نيبال',
    '+1': 'الولايات المتحدة/كندا',
    '+44': 'المملكة المتحدة',
    '+33': 'فرنسا',
    '+49': 'ألمانيا',
    '+39': 'إيطاليا',
    '+34': 'إسبانيا',
    '+31': 'هولندا',
    '+32': 'بلجيكا',
    '+41': 'سويسرا',
    '+43': 'النمسا',
    '+46': 'السويد',
    '+47': 'النرويج',
    '+45': 'الدنمارك',
    '+358': 'فنلندا',
    '+48': 'بولندا',
    '+420': 'جمهورية التشيك',
    '+421': 'سلوفاكيا',
    '+36': 'المجر',
    '+40': 'رومانيا',
    '+380': 'أوكرانيا',
    '+7': 'روسيا',
    '+81': 'اليابان',
    '+82': 'كوريا الجنوبية',
    '+86': 'الصين',
    '+852': 'هونغ كونغ',
    '+853': 'ماكاو',
    '+886': 'تايوان',
    '+65': 'سنغافورة',
    '+60': 'ماليزيا',
    '+66': 'تايلاند',
    '+84': 'فيتنام',
    '+62': 'إندونيسيا',
    '+63': 'الفلبين',
    '+61': 'أستراليا',
    '+64': 'نيوزيلندا',
    '+51': 'بيرو',
    '+52': 'المكسيك',
    '+54': 'الأرجنتين',
    '+55': 'البرازيل',
    '+56': 'تشيلي',
    '+57': 'كولومبيا',
    '+58': 'فنزويلا',
    '+593': 'الإكوادور',
    '+595': 'باراغواي',
    '+598': 'أوروغواي',
    '+591': 'بوليفيا',
    '+592': 'غيانا',
    '+594': 'غيانا الفرنسية',
    '+596': 'مارتينيك',
    '+597': 'سورينام',
    '+501': 'بليز',
    '+502': 'غواتيمالا',
    '+503': 'السلفادور',
    '+504': 'هندوراس',
    '+505': 'نيكاراغوا',
    '+506': 'كوستاريكا',
    '+507': 'بنما',
    '+509': 'هايتي',
    '+53': 'كوبا'
  };

  return countryNames[countryCode] || 'غير معروف';
}

/**
 * الحصول على رسالة توضيحية عن نوع OTP المستخدم
 */
export function getOTPMessage(method: OTPMethod, countryName: string): string {
  if (method === 'sms') {
    return `سيتم إرسال رمز التحقق عبر SMS إلى ${countryName}`;
  } else {
    return `سيتم إرسال رمز التحقق عبر WhatsApp إلى ${countryName}`;
  }
} 
