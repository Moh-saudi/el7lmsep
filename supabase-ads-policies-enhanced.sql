-- سياسات Storage محسنة للإعلانات في Supabase
-- قم بتشغيل هذه الأوامر في SQL Editor في Supabase Dashboard

-- ========================================
-- الخطوة 1: إنشاء Bucket الإعلانات (إذا لم يكن موجوداً)
-- ========================================
-- ملاحظة: يجب إنشاء Bucket يدوياً من خلال Storage Dashboard
-- اسم Bucket: ads
-- Public: true

-- ========================================
-- الخطوة 2: إنشاء السياسات
-- ========================================

-- 1. سياسة القراءة العامة لجميع الملفات في bucket الإعلانات
CREATE POLICY "Public Access to Ads" ON storage.objects
FOR SELECT USING (bucket_id = 'ads');

-- 2. سياسة الرفع للجميع (بدون مصادقة)
CREATE POLICY "Anyone can upload ads" ON storage.objects
FOR INSERT WITH CHECK (bucket_id = 'ads');

-- 3. سياسة التحديث للجميع (بدون مصادقة)
CREATE POLICY "Anyone can update ads" ON storage.objects
FOR UPDATE USING (bucket_id = 'ads');

-- 4. سياسة الحذف للجميع (بدون مصادقة)
CREATE POLICY "Anyone can delete ads" ON storage.objects
FOR DELETE USING (bucket_id = 'ads');

-- ========================================
-- الخطوة 3: التحقق من السياسات
-- ========================================

-- للتحقق من وجود السياسات، قم بتشغيل:
-- SELECT * FROM storage.policies WHERE bucket_id = 'ads';

-- ========================================
-- ملاحظات مهمة:
-- ========================================

-- 1. تأكد من إنشاء bucket باسم 'ads' أولاً
-- 2. تأكد من أن Bucket عام (public)
-- 3. هذه السياسات تسمح بالوصول العام لـ bucket الإعلانات
-- 4. للاستخدام في الإنتاج، قد تحتاج لتقييد الوصول حسب المستخدمين

-- ========================================
-- خطوات إضافية للتحقق:
-- ========================================

-- 1. انتقل إلى Storage Dashboard
-- 2. تحقق من وجود bucket 'ads'
-- 3. انتقل إلى Policies
-- 4. تأكد من وجود السياسات الأربع المذكورة أعلاه
-- 5. اختبر رفع ملف صغير للتأكد من عمل النظام

-- ========================================
-- استكشاف الأخطاء:
-- ========================================

-- إذا واجهت مشاكل:
-- 1. تحقق من وجود bucket 'ads'
-- 2. تحقق من أن bucket عام
-- 3. تحقق من وجود السياسات
-- 4. تحقق من متغيرات البيئة في التطبيق
-- 5. تحقق من console المتصفح للأخطاء

