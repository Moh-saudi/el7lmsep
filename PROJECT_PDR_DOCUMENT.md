# وثيقة متطلبات المنتج (PDR) - منصة إدارة اللاعبين El7lm

## 📋 جدول المحتويات
1. [نظرة عامة على المشروع](#نظرة-عامة-على-المشروع)
2. [المتطلبات الوظيفية](#المتطلبات-الوظيفية)
3. [المتطلبات غير الوظيفية](#المتطلبات-غير-الوظيفية)
4. [معمارية النظام](#معمارية-النظام)
5. [قاعدة البيانات](#قاعدة-البيانات)
6. [واجهات المستخدم](#واجهات-المستخدم)
7. [API والتكاملات](#api-والتكاملات)
8. [الأمان والخصوصية](#الأمان-والخصوصية)
9. [خطة التطوير](#خطة-التطوير)
10. [المخاطر والتحديات](#المخاطر-والتحديات)

---

## 🎯 نظرة عامة على المشروع

### اسم المشروع
**El7lm - منصة إدارة اللاعبين والفرق الرياضية**

### وصف المشروع
منصة شاملة لإدارة اللاعبين والفرق الرياضية، تتيح للاعبين والأندية والأكاديميات والوكلاء إدارة ملفاتهم الشخصية، والبحث عن الفرص، وإدارة العقود والمدفوعات.

### الأهداف الرئيسية
- إنشاء منصة موحدة لإدارة اللاعبين والفرق
- تسهيل التواصل بين مختلف الأطراف في المجال الرياضي
- توفير نظام دفع آمن ومتعدد العملات
- دعم اللغتين العربية والإنجليزية
- توفير واجهة مستخدم متجاوبة وسهلة الاستخدام

### الجمهور المستهدف
- **اللاعبين**: إدارة الملفات الشخصية والبحث عن فرص
- **الأندية**: البحث عن لاعبين وإدارة العقود
- **الأكاديميات**: إدارة الطلاب والدورات
- **الوكلاء**: إدارة اللاعبين والمفاوضات
- **المدربين**: إدارة الجلسات وتتبع التقدم
- **المسوقين**: إدارة الحملات والتحليلات

---

## ⚙️ المتطلبات الوظيفية

### 1. نظام المصادقة والتسجيل
- **التسجيل بالهاتف فقط**: استخدام رقم الهاتف مع OTP
- **تسجيل الدخول**: دعم الهاتف والبريد الإلكتروني
- **إدارة الأدوار**: لاعب، نادي، أكاديمية، وكيل، مدرب، مسوق
- **التحقق من الهوية**: نظام OTP عبر SMS وWhatsApp

### 2. إدارة الملفات الشخصية
- **ملف اللاعب الشامل**: معلومات شخصية، رياضية، طبية، تعليمية
- **مقاييس المهارات**: تقييم تقني، بدني، اجتماعي
- **المعرض الإعلامي**: صور وفيديوهات
- **التاريخ الرياضي**: الأندية السابقة والإنجازات

### 3. نظام البحث والاكتشاف
- **البحث المتقدم**: فلترة حسب الموقع، العمر، المهارات
- **خوارزميات التوصية**: اقتراح لاعبين مناسبين
- **مقارنة اللاعبين**: مقارنة مباشرة للمهارات

### 4. نظام المدفوعات
- **بوابة دفع متعددة**: Geidea مع دعم Apple Pay
- **عملات متعددة**: EGP، USD، EUR
- **إدارة الاشتراكات**: خطط مختلفة للمستخدمين
- **فواتير تلقائية**: إنشاء وإدارة الفواتير

### 5. نظام التواصل
- **رسائل فورية**: محادثات خاصة بين المستخدمين
- **إشعارات ذكية**: تنبيهات فورية للأحداث المهمة
- **دعم فني**: نظام تذاكر متكامل

### 6. لوحة التحكم الإدارية
- **إدارة المستخدمين**: مراقبة وإدارة جميع الحسابات
- **تقارير وتحليلات**: إحصائيات مفصلة عن النشاط
- **إدارة المحتوى**: مراقبة المحتوى المنشور
- **إدارة المدفوعات**: تتبع وإدارة المعاملات

---

## 🏗️ المتطلبات غير الوظيفية

### الأداء
- **زمن الاستجابة**: أقل من 300ms للصفحات الرئيسية
- **التوفر**: 99.9% من الوقت
- **قابلية التوسع**: دعم 10,000+ مستخدم متزامن

### الأمان
- **تشفير البيانات**: AES-256 للبيانات الحساسة
- **مصادقة قوية**: JWT tokens مع تجديد تلقائي
- **حماية من الهجمات**: CSRF، XSS، SQL Injection
- **امتثال GDPR**: حماية خصوصية المستخدمين

### سهولة الاستخدام
- **واجهة متجاوبة**: دعم جميع الأجهزة
- **دعم اللغات**: العربية والإنجليزية
- **إمكانية الوصول**: معايير WCAG 2.1
- **تجربة مستخدم سلسة**: تصميم بديهي

### الموثوقية
- **نسخ احتياطية**: يومية للبيانات
- **استرداد الكوارث**: خطة استرداد شاملة
- **مراقبة النظام**: تنبيهات فورية للمشاكل

---

## 🏛️ معمارية النظام

### التقنيات الأساسية
```
Frontend:
- Next.js 14 (App Router)
- React 18
- TypeScript
- Tailwind CSS
- Framer Motion

Backend:
- Next.js API Routes
- Firebase Functions
- Node.js

Database:
- Firebase Firestore (الرئيسية)
- Supabase (بديل/تخزين)

Authentication:
- Firebase Auth
- JWT Tokens

Storage:
- Firebase Storage
- Supabase Storage

Payments:
- Geidea Payment Gateway
- Apple Pay Integration

Notifications:
- BeOn SMS/WhatsApp API
- Firebase Cloud Messaging
```

### هيكل المشروع
```
src/
├── app/                    # Next.js App Router
│   ├── api/               # API Routes
│   │   ├── auth/          # مصادقة
│   │   ├── geidea/        # مدفوعات
│   │   ├── notifications/ # إشعارات
│   │   └── players/       # إدارة اللاعبين
│   ├── dashboard/         # لوحات التحكم
│   ├── auth/              # صفحات المصادقة
│   └── globals.css        # الأنماط العامة
├── components/            # المكونات القابلة لإعادة الاستخدام
│   ├── ui/               # مكونات واجهة المستخدم
│   ├── layout/           # مكونات التخطيط
│   └── shared/           # مكونات مشتركة
├── lib/                  # المكتبات والخدمات
│   ├── firebase/         # تكوين Firebase
│   ├── supabase/         # تكوين Supabase
│   ├── geidea/           # خدمات الدفع
│   └── utils/            # دوال مساعدة
├── hooks/                # React Hooks مخصصة
├── types/                # تعريفات TypeScript
└── utils/                # أدوات مساعدة
```

---

## 🗄️ قاعدة البيانات

### Firebase Firestore Collections

#### 1. المستخدمين (users)
```typescript
interface User {
  uid: string;
  email: string;
  phone: string;
  displayName: string;
  accountType: 'player' | 'club' | 'academy' | 'agent' | 'trainer' | 'marketer';
  isActive: boolean;
  verified: boolean;
  createdAt: Timestamp;
  lastLoginAt: Timestamp;
  profileCompleted: boolean;
  subscription?: SubscriptionInfo;
}
```

#### 2. اللاعبين (players)
```typescript
interface Player {
  id: string;
  userId: string;
  full_name: string;
  birth_date: string;
  nationality: string;
  position: string;
  height: number;
  weight: number;
  technical_skills: Record<string, number>;
  physical_skills: Record<string, number>;
  social_skills: Record<string, number>;
  medical_history: MedicalHistory;
  achievements: Achievement[];
  videos: Video[];
  photos: Photo[];
  isActive: boolean;
  createdAt: Timestamp;
}
```

#### 3. الأندية (clubs)
```typescript
interface Club {
  id: string;
  userId: string;
  name: string;
  country: string;
  city: string;
  description: string;
  logo: string;
  players: string[]; // Player IDs
  isActive: boolean;
  createdAt: Timestamp;
}
```

#### 4. المدفوعات (payments)
```typescript
interface Payment {
  id: string;
  userId: string;
  amount: number;
  currency: string;
  paymentMethod: string;
  status: 'pending' | 'completed' | 'failed';
  transactionId: string;
  orderId: string;
  createdAt: Timestamp;
}
```

#### 5. الرسائل (messages)
```typescript
interface Message {
  id: string;
  conversationId: string;
  senderId: string;
  receiverId: string;
  content: string;
  type: 'text' | 'image' | 'video';
  isRead: boolean;
  timestamp: Timestamp;
}
```

### Supabase Tables (بديل/تخزين)
```sql
-- جدول المدفوعات الجماعية
CREATE TABLE bulk_payments (
  id SERIAL PRIMARY KEY,
  user_id TEXT NOT NULL,
  account_type TEXT NOT NULL,
  players JSONB,
  total_amount DECIMAL(10,2),
  payment_status TEXT,
  transaction_id TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- تفعيل أمان الصفوف
ALTER TABLE bulk_payments ENABLE ROW LEVEL SECURITY;
```

---

## 🎨 واجهات المستخدم

### الصفحات الرئيسية

#### 1. الصفحة الرئيسية
- **Hero Section**: عرض مميزات المنصة
- **إحصائيات**: عدد المستخدمين واللاعبين
- **شهادات**: آراء المستخدمين
- **شركاء**: شعارات الشركاء

#### 2. لوحة التحكم
- **Dashboard الرئيسي**: نظرة عامة على النشاط
- **إحصائيات سريعة**: الملفات، الرسائل، المدفوعات
- **رسوم بيانية**: تحليلات الأداء
- **إشعارات**: التنبيهات المهمة

#### 3. إدارة الملف الشخصي
- **معلومات أساسية**: البيانات الشخصية
- **المهارات**: تقييم المهارات الرياضية
- **المعرض**: الصور والفيديوهات
- **التاريخ**: الإنجازات والخبرات

#### 4. البحث والاكتشاف
- **فلاتر متقدمة**: البحث حسب معايير متعددة
- **نتائج البحث**: عرض منظم للاعبين
- **مقارنة**: مقارنة مباشرة للمهارات
- **حفظ البحث**: حفظ معايير البحث المفضلة

### المكونات المشتركة

#### 1. شريط التنقل
- **Logo**: شعار المنصة
- **القائمة الرئيسية**: روابط الصفحات
- **معلومات المستخدم**: الصورة والاسم
- **قائمة منسدلة**: إعدادات الحساب

#### 2. نظام الإشعارات
- **جرس الإشعارات**: عرض عدد الإشعارات الجديدة
- **قائمة الإشعارات**: عرض الإشعارات الأخيرة
- **إعدادات الإشعارات**: تخصيص أنواع الإشعارات

#### 3. نظام الرسائل
- **قائمة المحادثات**: عرض المحادثات النشطة
- **نافذة المحادثة**: واجهة المحادثة
- **إرسال الرسائل**: نص، صور، فيديو

---

## 🔌 API والتكاملات

### API Endpoints

#### 1. المصادقة
```typescript
// فحص وجود المستخدم
POST /api/auth/check-user-exists
{
  "phone": "+201234567890"
}

// إرسال OTP
POST /api/sms/send-otp
{
  "phone": "+201234567890",
  "countryCode": "+20"
}

// التحقق من OTP
POST /api/sms/verify-otp
{
  "phone": "+201234567890",
  "code": "123456"
}
```

#### 2. المدفوعات (Geidea)
```typescript
// إنشاء جلسة دفع
POST /api/geidea/create-session
{
  "amount": 100,
  "currency": "EGP",
  "orderId": "order_123",
  "customerEmail": "user@example.com"
}

// معالجة Webhook
POST /api/geidea/webhook
{
  "orderId": "order_123",
  "status": "success",
  "transactionId": "txn_456"
}

// جلسة Apple Pay
POST /api/geidea/apple-pay-session
{
  "amount": 100,
  "currency": "EGP"
}
```

#### 3. إدارة اللاعبين
```typescript
// إنشاء ملف لاعب
POST /api/players/create
{
  "full_name": "أحمد محمد",
  "birth_date": "2000-01-01",
  "position": "مهاجم",
  "nationality": "مصر"
}

// تحديث الملف
PUT /api/players/{playerId}
{
  "technical_skills": {
    "dribbling": 85,
    "shooting": 80
  }
}

// البحث عن لاعبين
GET /api/players/search?position=مهاجم&age_min=18&age_max=25
```

#### 4. الإشعارات
```typescript
// إرسال SMS
POST /api/notifications/sms/send
{
  "phoneNumber": "+201234567890",
  "message": "مرحباً بك في منصة El7lm"
}

// إرسال WhatsApp
POST /api/notifications/whatsapp/send
{
  "phoneNumber": "+201234567890",
  "message": "تم تحديث ملفك الشخصي"
}
```

### التكاملات الخارجية

#### 1. Geidea Payment Gateway
- **التكامل**: REST API
- **الميزات**: مدفوعات متعددة العملات، Apple Pay
- **الأمان**: تشفير SSL، توقيع الطلبات

#### 2. BeOn SMS/WhatsApp API
- **التكامل**: REST API
- **الميزات**: إرسال SMS وWhatsApp
- **التحقق**: نظام OTP متكامل

#### 3. Firebase Services
- **Authentication**: مصادقة المستخدمين
- **Firestore**: قاعدة البيانات الرئيسية
- **Storage**: تخزين الملفات
- **Cloud Messaging**: الإشعارات الفورية

---

## 🔒 الأمان والخصوصية

### إجراءات الأمان

#### 1. مصادقة قوية
- **Firebase Auth**: مصادقة آمنة مع دعم OTP
- **JWT Tokens**: رموز مصادقة مع تجديد تلقائي
- **Rate Limiting**: حماية من الهجمات

#### 2. تشفير البيانات
- **HTTPS**: تشفير جميع الاتصالات
- **AES-256**: تشفير البيانات الحساسة
- **Hashing**: تشفير كلمات المرور

#### 3. حماية من الهجمات
- **CORS**: حماية من الطلبات غير المصرح بها
- **CSRF Protection**: حماية من هجمات CSRF
- **XSS Prevention**: منع هجمات XSS
- **SQL Injection**: حماية من حقن SQL

### خصوصية البيانات

#### 1. امتثال GDPR
- **موافقة المستخدم**: جمع الموافقة على استخدام البيانات
- **حق النسيان**: إمكانية حذف البيانات الشخصية
- **شفافية البيانات**: إعلام المستخدمين بكيفية استخدام البيانات

#### 2. إدارة البيانات
- **تخزين آمن**: تشفير البيانات المخزنة
- **نسخ احتياطية**: نسخ احتياطية مشفرة
- **حذف آمن**: حذف البيانات بشكل آمن

---

## 📅 خطة التطوير

### المرحلة الأولى (4 أسابيع)
- [x] ✅ إعداد البنية الأساسية
- [x] ✅ نظام المصادقة والتسجيل
- [x] ✅ إدارة الملفات الشخصية الأساسية
- [x] ✅ واجهة المستخدم الأساسية

### المرحلة الثانية (6 أسابيع)
- [x] ✅ نظام المدفوعات
- [x] ✅ نظام البحث والاكتشاف
- [x] ✅ نظام الرسائل والإشعارات
- [x] ✅ لوحة التحكم الإدارية

### المرحلة الثالثة (4 أسابيع)
- [ ] 🔄 تحسينات الأداء
- [ ] 🔄 اختبارات شاملة
- [ ] 🔄 تحسينات الأمان
- [ ] 🔄 إعداد الإنتاج

### المرحلة الرابعة (2 أسابيع)
- [ ] 📋 إطلاق تجريبي
- [ ] 📋 جمع الملاحظات
- [ ] 📋 إصلاح الأخطاء
- [ ] 📋 الإطلاق النهائي

---

## ⚠️ المخاطر والتحديات

### المخاطر التقنية

#### 1. أداء النظام
- **المخاطرة**: بطء النظام مع زيادة عدد المستخدمين
- **الحل**: تحسين قاعدة البيانات، استخدام CDN، تحسين الكود

#### 2. أمان البيانات
- **المخاطرة**: اختراق البيانات الشخصية
- **الحل**: تشفير قوي، مراجعات أمنية دورية، تدريب الفريق

#### 3. تكامل الخدمات الخارجية
- **المخاطرة**: فشل خدمات الدفع أو الإشعارات
- **الحل**: أنظمة بديلة، مراقبة مستمرة، إشعارات فورية

### المخاطر التجارية

#### 1. قبول المستخدمين
- **المخاطرة**: عدم قبول المنصة من المستخدمين
- **الحل**: اختبارات المستخدمين، تحسين تجربة المستخدم، تسويق فعال

#### 2. المنافسة
- **المخاطرة**: ظهور منافسين أقوياء
- **الحل**: تطوير ميزات فريدة، تحسين الخدمة، بناء مجتمع قوي

#### 3. التكلفة
- **المخاطرة**: ارتفاع تكاليف التشغيل
- **الحل**: تحسين الكفاءة، خطة تسعير مناسبة، نموذج عمل مستدام

---

## 📊 المقاييس والتحليلات

### مقاييس الأداء
- **زمن الاستجابة**: متوسط < 300ms
- **معدل الخطأ**: أقل من 0.1%
- **التوفر**: 99.9% من الوقت
- **عدد المستخدمين المتزامنين**: 10,000+

### مقاييس الأعمال
- **عدد المستخدمين المسجلين**: هدف 50,000 في السنة الأولى
- **معدل الاحتفاظ**: 80% شهرياً
- **معدل التحويل**: 5% من الزوار إلى مستخدمين مسجلين
- **الإيرادات**: هدف 1 مليون جنيه مصري في السنة الأولى

### أدوات المراقبة
- **Sentry**: مراقبة الأخطاء والأداء
- **Google Analytics**: تحليلات المستخدمين
- **Firebase Analytics**: تحليلات التطبيق
- **Custom Dashboard**: لوحة تحكم مخصصة للمقاييس

---

## 🚀 خطة الإطلاق

### الإطلاق التجريبي (Beta)
- **المدة**: 2 أسابيع
- **المستخدمين**: 100 مستخدم تجريبي
- **الهدف**: اختبار الوظائف وجمع الملاحظات
- **المقاييس**: معدل الأخطاء، رضا المستخدمين

### الإطلاق العام
- **التاريخ**: بعد الإطلاق التجريبي
- **المستخدمين**: جميع المستخدمين
- **الهدف**: جذب المستخدمين وبناء المجتمع
- **المقاييس**: عدد التسجيلات، النشاط اليومي

### التطوير المستمر
- **التحديثات**: أسبوعية للتحسينات الصغيرة
- **الإصدارات الكبرى**: شهرية للميزات الجديدة
- **الصيانة**: دورية للأمان والأداء

---

## 📞 الدعم والصيانة

### دعم المستخدمين
- **الدعم الفني**: 24/7 عبر البريد الإلكتروني والدردشة
- **الوثائق**: دليل شامل للمستخدمين
- **الفيديو التعليمي**: فيديوهات توضيحية
- **الأسئلة الشائعة**: قسم FAQ شامل

### صيانة النظام
- **المراقبة**: مراقبة مستمرة للأداء والأخطاء
- **النسخ الاحتياطية**: يومية للبيانات
- **التحديثات**: تحديثات دورية للأمان
- **التقارير**: تقارير شهرية عن الأداء

---

## 📋 الخلاصة

منصة El7lm هي حل شامل لإدارة اللاعبين والفرق الرياضية، مصممة لتلبية احتياجات جميع الأطراف في المجال الرياضي. المنصة تجمع بين التقنيات الحديثة وتجربة مستخدم ممتازة لتوفير حل فعال ومستدام.

### النقاط الرئيسية
- ✅ **تقنيات حديثة**: Next.js 14، Firebase، TypeScript
- ✅ **أمان قوي**: تشفير، مصادقة متعددة العوامل
- ✅ **واجهة متجاوبة**: دعم جميع الأجهزة
- ✅ **مدفوعات آمنة**: Geidea مع دعم Apple Pay
- ✅ **دعم اللغات**: العربية والإنجليزية
- ✅ **قابلية التوسع**: بنية قابلة للتطوير

### التوصيات
1. **البدء بالإطلاق التجريبي** لجمع الملاحظات
2. **التركيز على تجربة المستخدم** لضمان القبول
3. **الاستثمار في الأمان** لحماية البيانات
4. **بناء مجتمع قوي** لضمان النمو المستدام

---

**تاريخ الإنشاء**: يناير 2025  
**آخر تحديث**: يناير 2025  
**الإصدار**: 1.0  
**المؤلف**: فريق تطوير El7lm
