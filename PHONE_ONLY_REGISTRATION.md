# ูุธุงู ุงูุชุณุฌูู ุจุงููุงุชู ููุท - Phone-Only Registration System

## ๐ฑ ูุธุฑุฉ ุนุงูุฉ

ูุฐุง ุงููุธุงู ูุชูุญ ุงูุชุณุฌูู ูุชุณุฌูู ุงูุฏุฎูู ุจุงุณุชุฎุฏุงู ุฑูู ุงููุงุชู ููุทุ ูุน ุงูุชุญูู ุนุจุฑ OTP (ูููุฉ ูุฑูุฑ ููุฑุฉ ูุงุญุฏุฉ).

## โจ ุงููููุฒุงุช

### ๐ ุงูุฃูุงู
- **Firestore Rules**: ููุงุนุฏ ุฃูุงู ุตุงุฑูุฉ ุชุชุทูุจ ูุตุงุฏูุฉ ูููุตูู ููุจูุงูุงุช
- **Admin SDK**: ุงุณุชุฎุฏุงู Firebase Admin SDK ูููุตูู ุงูุขูู ููุจูุงูุงุช
- **OTP Storage**: ุชุฎุฒูู OTP ูู ุงูุฐุงูุฑุฉ ูุน ุงูุชูุงุก ุงูุตูุงุญูุฉ
- **Rate Limiting**: ุญูุงูุฉ ูู ุงูุฅูุฑุงุท ูู ุงูุทูุจุงุช

### ๐ ุงูุชุญูู ูู ุงููุงุชู
- **ุฏุนู ุงูุจูุฏุงู**: ูุงุฆูุฉ ุดุงููุฉ ูู ุงูุจูุฏุงู ูุน ุฑููุฒ ุงููุงุชู
- **ุชุทุจูุน ุงูุฃุฑูุงู**: ูุนุงูุฌุฉ ุชููุงุฆูุฉ ูุฃุดูุงู ูุฎุชููุฉ ูู ุฃุฑูุงู ุงููุงุชู
- **ุงูุชุญูู ูู ุงููุฌูุฏ**: ูุญุต ุณุฑูุน ููุฌูุฏ ุงููุณุชุฎุฏู ูุจู ุงูุชุณุฌูู

### ๐ OTP System
- **ุฅุฑุณุงู OTP**: ุนุจุฑ SMS ุฃู WhatsApp
- **ุงูุชุญูู**: ูุนุงูุฌุฉ ูุญุงููุงุช ูุชุนุฏุฏุฉ
- **ุงูุชูุงุก ุงูุตูุงุญูุฉ**: 5 ุฏูุงุฆู ุชููุงุฆูุงู
- **ูุญุงููุงุช ูุญุฏูุฏุฉ**: ุญูุงูุฉ ูู ุงูุชุฎููู

## ๐๏ธ ูููู ุงูุจูุงูุงุช ูู Firestore

### ๐ ูุฌููุนุฉ ุงููุณุชุฎุฏููู (users)
```javascript
{
  uid: "user_id_from_firebase_auth",
  phone: "+201234567890",
  accountType: "player|academy|club|agent|trainer|parent",
  email: "temp_email@firebase.internal", // ูุคูุช ุฏุงุฎูู
  displayName: "ุงุณู ุงููุณุชุฎุฏู",
  createdAt: timestamp,
  lastLoginAt: timestamp,
  isActive: true,
  phoneVerified: true,
  // ุจูุงูุงุช ุฅุถุงููุฉ ุญุณุจ ููุน ุงูุญุณุงุจ
}
```

### ๐ฑ OTP Storage (ูู ุงูุฐุงูุฑุฉ)
```javascript
{
  phone: "+201234567890",
  code: "123456",
  attempts: 0,
  maxAttempts: 3,
  expiresAt: timestamp,
  createdAt: timestamp
}
```

## ๐ ุงูุจูุฏุงู ุงููุฏุนููุฉ

### ูุตุฑ (Egypt)
- **ุงูููุฏ**: +20
- **ุงูุชูุณูู**: +20XXXXXXXXX

### ุงูููููุฉ ุงูุนุฑุจูุฉ ุงูุณุนูุฏูุฉ (Saudi Arabia)
- **ุงูููุฏ**: +966
- **ุงูุชูุณูู**: +966XXXXXXXXX

### ุงูุฅูุงุฑุงุช ุงูุนุฑุจูุฉ ุงููุชุญุฏุฉ (UAE)
- **ุงูููุฏ**: +971
- **ุงูุชูุณูู**: +971XXXXXXXXX

### ูุทุฑ (Qatar)
- **ุงูููุฏ**: +974
- **ุงูุชูุณูู**: +974XXXXXXXXX

### ุงููููุช (Kuwait)
- **ุงูููุฏ**: +965
- **ุงูุชูุณูู**: +965XXXXXXXXX

### ุนูุงู (Oman)
- **ุงูููุฏ**: +968
- **ุงูุชูุณูู**: +968XXXXXXXXX

### ุงูุจุญุฑูู (Bahrain)
- **ุงูููุฏ**: +973
- **ุงูุชูุณูู**: +973XXXXXXXXX

### ุงูุฃุฑุฏู (Jordan)
- **ุงูููุฏ**: +962
- **ุงูุชูุณูู**: +962XXXXXXXXX

### ูุจูุงู (Lebanon)
- **ุงูููุฏ**: +961
- **ุงูุชูุณูู**: +961XXXXXXXXX

### ุงูุนุฑุงู (Iraq)
- **ุงูููุฏ**: +964
- **ุงูุชูุณูู**: +964XXXXXXXXX

### ุงููุบุฑุจ (Morocco)
- **ุงูููุฏ**: +212
- **ุงูุชูุณูู**: +212XXXXXXXXX

### ุงูุฌุฒุงุฆุฑ (Algeria)
- **ุงูููุฏ**: +213
- **ุงูุชูุณูู**: +213XXXXXXXXX

### ุชููุณ (Tunisia)
- **ุงูููุฏ**: +216
- **ุงูุชูุณูู**: +216XXXXXXXXX

### ููุจูุง (Libya)
- **ุงูููุฏ**: +218
- **ุงูุชูุณูู**: +218XXXXXXXXX

### ุงูุณูุฏุงู (Sudan)
- **ุงูููุฏ**: +249
- **ุงูุชูุณูู**: +249XXXXXXXXX

### ุงูููู (Yemen)
- **ุงูููุฏ**: +967
- **ุงูุชูุณูู**: +967XXXXXXXXX

### ุณูุฑูุง (Syria)
- **ุงูููุฏ**: +963
- **ุงูุชูุณูู**: +963XXXXXXXXX

### ููุณุทูู (Palestine)
- **ุงูููุฏ**: +970
- **ุงูุชูุณูู**: +970XXXXXXXXX

## ๐ง Firestore Rules

### ุงูููุงุนุฏ ุงูุญุงููุฉ (ุขููุฉ ููุฅูุชุงุฌ)
```javascript
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // ๐ ูุงุนุฏุฉ ุฃุณุงุณูุฉ: ุฃู ูุณุชุฎุฏู ูุตุงุฏู ุนููู ููููู ุงููุฑุงุกุฉ ูุงููุชุงุจุฉ
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
    
    // ๐ก๏ธ ููุงุนุฏ ุฅุถุงููุฉ ููุฃูุงู
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    match /admins/{adminId} {
      allow read, write: if request.auth != null;
    }
    
    // ๐ฌ ููุงุนุฏ ุงูุฑุณุงุฆู ูุงูุฏุนู ุงูููู
    match /messages/{messageId} {
      allow read, write: if request.auth != null;
    }
    
    match /conversations/{conversationId} {
      allow read, write: if request.auth != null;
    }
    
    match /support_messages/{messageId} {
      allow read, write: if request.auth != null;
    }
    
    match /support_conversations/{conversationId} {
      allow read, write: if request.auth != null;
    }
  }
}
```

## ๐ API Endpoints

### 1. ูุญุต ูุฌูุฏ ุงููุณุชุฎุฏู
```
POST /api/auth/check-user-exists
```
**ุงููุฏุฎูุงุช:**
```json
{
  "phone": "+201234567890"
}
```

**ุงููุฎุฑุฌุงุช:**
```json
{
  "emailExists": false,
  "phoneExists": true
}
```

### 2. ุฅุฑุณุงู OTP
```
POST /api/sms/send-otp
```
**ุงููุฏุฎูุงุช:**
```json
{
  "phone": "+201234567890",
  "countryCode": "+20"
}
```

**ุงููุฎุฑุฌุงุช:**
```json
{
  "success": true,
  "message": "ุชู ุฅุฑุณุงู ุฑูุฒ ุงูุชุญูู ุจูุฌุงุญ"
}
```

### 3. ุงูุชุญูู ูู OTP
```
POST /api/sms/verify-otp
```
**ุงููุฏุฎูุงุช:**
```json
{
  "phone": "+201234567890",
  "code": "123456"
}
```

**ุงููุฎุฑุฌุงุช:**
```json
{
  "success": true,
  "message": "ุชู ุงูุชุญูู ุจูุฌุงุญ"
}
```

## ๐ ุงูุฃูุงู ูุงูุฎุตูุตูุฉ

### โ ุงููููุฒุงุช ุงูุฃูููุฉ
- **Firestore Rules**: ููุงุนุฏ ุตุงุฑูุฉ ุชุชุทูุจ ูุตุงุฏูุฉ
- **Admin SDK**: ูุตูู ุขูู ููุจูุงูุงุช ูู ุงูุฎุงุฏู
- **OTP Expiry**: ุงูุชูุงุก ุชููุงุฆู ุจุนุฏ 5 ุฏูุงุฆู
- **Rate Limiting**: ุญูุงูุฉ ูู ุงูุฅูุฑุงุท ูู ุงูุทูุจุงุช
- **Phone Normalization**: ูุนุงูุฌุฉ ููุญุฏุฉ ูุฃุฑูุงู ุงููุงุชู

### โ๏ธ ุงุนุชุจุงุฑุงุช ุงูุฅูุชุงุฌ
- **Firebase Admin SDK**: ุชุฃูุฏ ูู ุชูููู ุงูููุงุชูุญ ุงูุฎุงุตุฉ ุจุดูู ุตุญูุญ
- **Environment Variables**: ุชุฃูุฏ ูู ูุฌูุฏ ุฌููุน ุงููุชุบูุฑุงุช ุงููุทููุจุฉ
- **SMS Service**: ุชุฃูุฏ ูู ุชูููู ุฎุฏูุฉ SMS ุจุดูู ุตุญูุญ
- **Rate Limiting**: ูุฑุงูุจุฉ ุงุณุชุฎุฏุงู API ูุชุนุฏูู ุงูุญุฏูุฏ ุญุณุจ ุงูุญุงุฌุฉ

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ูุดุงูู OTP
1. **OTP ูุง ูุตู**: ุชุญูู ูู ุชูููู SMS service
2. **OTP ููุชูู ุงูุตูุงุญูุฉ**: ุชุญูู ูู ุฅุนุฏุงุฏุงุช ุงูููุช
3. **ูุญุงููุงุช ูุซูุฑุฉ**: ุงูุชุธุฑ 5 ุฏูุงุฆู ูุจู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู

### ูุดุงูู Firebase
1. **Permission Denied**: ุชุญูู ูู Firestore Rules
2. **Admin SDK Error**: ุชุญูู ูู ุชูููู Firebase Admin
3. **User Not Found**: ุชุญูู ูู ูุฌูุฏ ุงููุณุชุฎุฏู ูู Firestore

### ูุดุงูู ุงููุงุชู
1. **ุฑูู ุบูุฑ ุตุญูุญ**: ุชุญูู ูู ุชูุณูู ุงูุฑูู ูุงูุจูุฏ
2. **ุจูุฏ ุบูุฑ ูุฏุนูู**: ุชุญูู ูู ูุงุฆูุฉ ุงูุจูุฏุงู ุงููุฏุนููุฉ
3. **ุชุทุจูุน ุงูุฑูู**: ุชุญูู ูู ูุนุงูุฌุฉ ุงูุฑูู

## ๐ ููุงุญุธุงุช ุงูุชุทููุฑ

### ููุชุทููุฑ ุงููุญูู
- ุงุณุชุฎุฏู Firebase Emulator Suite ููุงุฎุชุจุงุฑ
- ุชุฃูุฏ ูู ุชูููู Firebase Admin SDK
- ุงุฎุชุจุฑ ุฌููุน ุณููุงุฑูููุงุช OTP

### ููุฅูุชุงุฌ
- ูุดุฑ Firestore Rules ุงููุญุฏุซุฉ
- ุชูููู Firebase Admin SDK ุจุดูู ุตุญูุญ
- ูุฑุงูุจุฉ ุงุณุชุฎุฏุงู API ูุงูุฃุฎุทุงุก
- ุงุฎุชุจุงุฑ ุดุงูู ูุจู ุงููุดุฑ

## ๐ ุงูุชุญุฏูุซุงุช ุงููุณุชูุจููุฉ

### ุงููููุฒุงุช ุงูููุชุฑุญุฉ
- **WhatsApp OTP**: ุฏุนู ุฅุฑุณุงู OTP ุนุจุฑ WhatsApp
- **Voice OTP**: ุฏุนู OTP ุงูุตูุชู
- **Backup Codes**: ุฑููุฒ ุงุญุชูุงุทูุฉ ูููุตูู
- **Two-Factor Authentication**: ูุตุงุฏูุฉ ุซูุงุฆูุฉ ุงูุนุงูู

### ุงูุชุญุณููุงุช
- **Caching**: ุชุฎุฒูู ูุคูุช ูุจูุงูุงุช ุงููุณุชุฎุฏููู
- **Analytics**: ุชุชุจุน ุงุณุชุฎุฏุงู ุงููุธุงู
- **Monitoring**: ูุฑุงูุจุฉ ุงูุฃุฏุงุก ูุงูุฃุฎุทุงุก
- **Backup**: ูุณุฎ ุงุญุชูุงุทูุฉ ููุจูุงูุงุช 
