console.log("?? ???? ????? ???????? ?????");

// ???? ????? ???? ???? ????
window.fixAliFeras = async function() {
    console.log('?? ????? ??? ????...');
    
    try {
        if (typeof firebase === 'undefined') {
            throw new Error('Firebase ??? ????');
        }
        
        const db = firebase.firestore();
        
        // ????? ??? ???? ????? ????? ?????
        await db.collection('players').doc('hChYVnu04cXe3KK8JJQu').update({
            club_id: 'Nwr78w2YdYQhsKqHzPlCPGwGN2B3',
            updated_at: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        console.log('? ?? ????? ??? ???? ?????');
        console.log('?? ????? ????? ??????...');
        
        setTimeout(() => {
            window.location.reload();
        }, 2000);
        
    } catch(error) {
        console.error('? ??? ?? ????? ??? ????:', error);
    }
};

// ???? ??? ???? ????? ??????
window.quickCheck = async function() {
    const urlParams = new URLSearchParams(window.location.search);
    const viewPlayerId = urlParams.get('view');
    
    if (!viewPlayerId) {
        console.log('? ?? ???? ???? ???? ?? URL');
        return;
    }
    
    console.log(`?? ??? ???? ?????: ${viewPlayerId}`);
    
    try {
        const db = firebase.firestore();
        const playerDoc = await db.collection('players').doc(viewPlayerId).get();
        
        if (!playerDoc.exists) {
            console.log('? ?????? ??? ?????');
            return;
        }
        
        const playerData = playerDoc.data();
        console.log('?? ??? ??????:', playerData.full_name);
        
        // ??? ????????
        const orgFields = ['club_id', 'clubId', 'academy_id', 'academyId', 'trainer_id', 'trainerId', 'agent_id', 'agentId'];
        let hasOrg = false;
        
        for (const field of orgFields) {
            if (playerData[field]) {
                console.log(`? ???? ??????: ${field} = ${playerData[field]}`);
                hasOrg = true;
                break;
            }
        }
        
        if (!hasOrg) {
            console.log('?? ?????? ?????');
            
            if (viewPlayerId === 'hChYVnu04cXe3KK8JJQu') {
                console.log('?? ??? ??? ???? - ??? fixAliFeras() ?????? ????????');
            }
        }
        
    } catch (error) {
        console.error('? ??? ?? ?????:', error);
    }
};

console.log('? ????? ??????? ?????');
console.log('?? ??????? ???????:');
console.log('  - fixAliFeras() - ????? ??? ????');
console.log('  - quickCheck() - ??? ???? ????? ??????');

// ????? ??? ??????
setTimeout(() => {
    quickCheck();
}, 1000);
