# ๐ ุชูุฑูุฑ ุฅุตูุงุญ ูุธุงู ุงูุงุดุชุฑุงูุงุช ูุงููุฏููุนุงุช

## ๐ฏ ุงููุดููุฉ ุงููุจูุบ ุนููุง

**ุงููุณุชุฎุฏู:** `0555555555@hagzzgo.com`  
**ุงููุดููุฉ:** ุงูุฏูุน ูุฌุญ ูุฑุชูู ูุธูุฑุช ุฑุณุงูุฉ ุงููุฌุงุญุ ููู ุงูุจูุงูุงุช ูุง ุชุธูุฑ ูู:
- ุตูุญุฉ ุงูุงุดุชุฑุงู (`/dashboard/subscription`)
- ุงูููู ุงูุดุฎุตู

## ๐ ุงูุชุญููู ุงูุฃููู

### ุงููุดุงูู ุงููุญุชููุฉ:
1. **ุงููุณุชุฎุฏู ูู ูุฌููุนุฉ ูุฎุชููุฉ:** ูุฏ ูููู ูู `players` ุจุฏูุงู ูู `users`
2. **ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุญููุธ ุจุชูุณูู ูุฎุชูู**
3. **ุงููุฏููุนุงุช ูุญููุธุฉ ุจุฏูู userId ุตุญูุญ**
4. **ูุนุงูุฌ ุงูู callback ูุง ูุนูู ุจุดูู ุตุญูุญ**

## โ ุงูุชุญุณููุงุช ุงููุทุจูุฉ

### 1. ุชุญุณูู ุตูุญุฉ ุงูุงุดุชุฑุงู (`src/app/dashboard/subscription/page.tsx`)

#### ุงูุชุญุณููุงุช:
- **ุงูุจุญุซ ูู ุฌููุน ุงููุฌููุนุงุช:** `users`, `players`, `clubs`, `academies`, `agents`, `trainers`
- **ุงูุจุญุซ ุจุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุฑูู ุงููุงุชู**
- **ูุฑุงูุจุฉ ููุตูุฉ ููุนูููุงุช ูุน ุฑุณุงุฆู Console**
- **ูุญุต ุจูุงูุงุช ุงูุงุดุชุฑุงู ูู ุงูููู ุงูุดุฎุตู**

#### ุงูููุฏ ุงููุญุณู:
```typescript
// ุงูุจุญุซ ูู ุฌููุน ุงููุฌููุนุงุช ููุนุซูุฑ ุนูู ุงููุณุชุฎุฏู
const collections = ['users', 'players', 'clubs', 'academies', 'agents', 'trainers'];
let foundUser = null;
let foundCollection = '';

for (const collectionName of collections) {
  // ุงูุจุญุซ ุจุงูุจุฑูุฏ ุงูุฅููุชุฑููู
  const emailQuery = query(collectionRef, where('email', '==', user.email));
  const emailSnapshot = await getDocs(emailQuery);
  
  if (!emailSnapshot.empty) {
    foundUser = emailSnapshot.docs[0].data();
    foundCollection = collectionName;
    break;
  }

  // ุงูุจุญุซ ุจุฑูู ุงููุงุชู
  if (user.phone) {
    const phoneQuery = query(collectionRef, where('phone', '==', user.phone));
    const phoneSnapshot = await getDocs(phoneQuery);
    
    if (!phoneSnapshot.empty) {
      foundUser = phoneSnapshot.docs[0].data();
      foundCollection = collectionName;
      break;
    }
  }
}
```

### 2. ุชุญุณูู ูุนุงูุฌ ุงูู Callback (`src/app/api/geidea/callback/route.ts`)

#### ุงูุชุญุณููุงุช:
- **ุงูุจุญุซ ุนู ุงููุณุชุฎุฏู ูู ุฌููุน ุงููุฌููุนุงุช**
- **ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก**
- **ุฅูุดุงุก ุงููุณุชุฎุฏู ุฅุฐุง ูู ููู ููุฌูุฏุงู**
- **ูุฑุงูุจุฉ ููุตูุฉ ููุนูููุงุช**

#### ุงูููุฏ ุงููุญุณู:
```typescript
// ุงูุจุญุซ ุนู ุงููุณุชุฎุฏู ูู ุฌููุน ุงููุฌููุนุงุช
const collections = ['users', 'players', 'clubs', 'academies', 'agents', 'trainers'];
let userFound = false;
let userCollection = '';
let userDocRef = null;

for (const collectionName of collections) {
  try {
    const collectionRef = collection(db, collectionName);
    const userQuery = query(collectionRef, where('__name__', '==', userId));
    const userSnapshot = await getDocs(userQuery);
    
    if (!userSnapshot.empty) {
      userFound = true;
      userCollection = collectionName;
      userDocRef = doc(db, collectionName, userId);
      break;
    }
  } catch (error) {
    console.log(`โ๏ธ Error searching in ${collectionName}:`, error);
  }
}
```

## ๐งช ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ

### 1. ุงุฎุชุจุงุฑ ุงููุธุงู:
```bash
# ุชุดุบูู ุงูุณูุฑูุฑ
npm run dev

# ูุชุญ ุงููุชุตูุญ
http://localhost:3001
```

### 2. ุงุฎุชุจุงุฑ ุงููุณุชุฎุฏู:
- **ุชุณุฌูู ุฏุฎูู:** `0555555555@hagzzgo.com`
- **ุงูุฐูุงุจ ุฅูู:** `/dashboard/subscription`
- **ูุชุญ Developer Tools (F12)**
- **ูุฑุงูุจุฉ Console ููุฑุณุงุฆู**

### 3. ุงูุฑุณุงุฆู ุงููุชููุนุฉ ูู Console:
```
๐ ุฌูุจ ุจูุงูุงุช ุงูุงุดุชุฑุงู ูููุณุชุฎุฏู: [user-id]
๐ง ุงูุจุฑูุฏ ุงูุฅููุชุฑููู: 0555555555@hagzzgo.com
1๏ธโฃ ุงูุจุญุซ ูู ูุฌููุนุฉ bulkPayments...
2๏ธโฃ ุงูุจุญุซ ูู ูุฌููุนุฉ subscriptions...
3๏ธโฃ ุงูุจุญุซ ูู ูุฌููุนุฉ bulk_payments...
4๏ธโฃ ุงูุจุญุซ ูู ุฌููุน ุงููุฌููุนุงุช ููุนุซูุฑ ุนูู ุงููุณุชุฎุฏู...
๐ ุงูุจุญุซ ูู ูุฌููุนุฉ users...
๐ ุงูุจุญุซ ูู ูุฌููุนุฉ players...
โ ุชู ุงูุนุซูุฑ ุนูู ุงููุณุชุฎุฏู ูู ูุฌููุนุฉ [collection-name]
```

## ๐ง ูุญุต ูุงุนุฏุฉ ุงูุจูุงูุงุช

### 1. ูุญุต ุงููุฏููุนุงุช:
- **Firebase Console** โ **Firestore Database**
- **ูุฌููุนุฉ:** `bulkPayments`
- **ุงูุจุญุซ ุนู:** `userId: [user-id]` ู `status: "completed"`

### 2. ูุญุต ุงููุณุชุฎุฏู:
- **ูุฌููุนุฉ:** `users` ุฃู `players`
- **ุงูุจุญุซ ุนู:** `email: 0555555555@hagzzgo.com`
- **ูุญุต:** `subscriptionStatus: "active"`

## ๐ฏ ุงูุญููู ุงููุญุชููุฉ

### ุฅุฐุง ูุฌุฏุช ูุฏููุนุงุช ูููู ูุง ุชูุฌุฏ ุงุดุชุฑุงู:
1. **ูุญุต ูุนุงูุฌ ุงูู callback**
2. **ุงูุชุฃูุฏ ูู ุงุณุชุฎุฑุงุฌ userId ุจุดูู ุตุญูุญ**
3. **ูุญุต ุฃู merchantReferenceId ูุญุชูู ุนูู userId ุตุญูุญ**

### ุฅุฐุง ูู ุชูุฌุฏ ูุฏููุนุงุช:
1. **ูุญุต ุฃู webhook ูุนูู ุจุดูู ุตุญูุญ**
2. **ูุญุต ุฃู callback URL ุตุญูุญ**
3. **ูุญุต ุฅุนุฏุงุฏุงุช ุฌูุฏูุง**

### ุฅุฐุง ูุฌุฏ ุงููุณุชุฎุฏู ูู ูุฌููุนุฉ ูุฎุชููุฉ:
1. **ุงูุจุญุซ ูู ุฌููุน ุงููุฌููุนุงุช** โ (ูุทุจูุฉ)
2. **ุชุญุฏูุซ ููุทู ุงูุจุญุซ** โ (ูุทุจูุฉ)

## ๐ ุงููุชุงุฆุฌ ุงููุชููุนุฉ

### โ ุจุนุฏ ุงูุชุญุณููุงุช:
- **ุงูุจุญุซ ูู ุฌููุน ุงููุฌููุนุงุช**
- **ุนุฑุถ ุจูุงูุงุช ุงูุงุดุชุฑุงู ุฅุฐุง ูุฌุฏุช**
- **ุฑุณุงุฆู ููุตูุฉ ูู Console**
- **ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก**

### ๐จ ุฅุฐุง ูู ุชุธูุฑ ุงูุจูุงูุงุช:
1. **ูุญุต Firebase Console ูุจุงุดุฑุฉ**
2. **ุงูุจุญุซ ูู ูุฌููุนุฉ "bulkPayments"**
3. **ุงูุจุญุซ ูู ูุฌููุนุฉ "users" ู "players"**
4. **ูุญุต ุฃู merchantReferenceId ูุญุชูู ุนูู userId ุตุญูุญ**

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. **ุงุฎุชุจุงุฑ ุงููุธุงู ูุน ุงููุณุชุฎุฏู ุงููุฐููุฑ**
2. **ูุฑุงูุจุฉ Console ููุฑุณุงุฆู**
3. **ูุญุต ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุจุงุดุฑุฉ**
4. **ุฅุจูุงุบ ุงููุชุงุฆุฌ**

## ๐ ุงููููุงุช ุงููุญุฏุซุฉ

1. **`src/app/dashboard/subscription/page.tsx`** - ุชุญุณูู ุงูุจุญุซ ูู ุฌููุน ุงููุฌููุนุงุช
2. **`src/app/api/geidea/callback/route.ts`** - ุชุญุณูู ูุนุงูุฌ ุงูู callback
3. **`scripts/test-subscription-system.js`** - ุณูุฑูุจุช ุงุฎุชุจุงุฑ ุงููุธุงู
4. **`scripts/debug-user-payment.js`** - ุณูุฑูุจุช ูุญุต ุงููุณุชุฎุฏู

## โ ุงูุฎูุงุตุฉ

ุชู ุชุทุจูู ุชุญุณููุงุช ุดุงููุฉ ุนูู ูุธุงู ุงูุงุดุชุฑุงูุงุช ูุงููุฏููุนุงุช:

1. **ุชุญุณูู ุงูุจุญุซ:** ุงูุจุญุซ ูู ุฌููุน ุงููุฌููุนุงุช ุจุฏูุงู ูู ูุฌููุนุฉ ูุงุญุฏุฉ
2. **ุชุญุณูู ูุนุงูุฌ ุงูู callback:** ุงูุชุนุงูู ูุน ุฌููุน ุฃููุงุน ุงููุณุชุฎุฏููู
3. **ุฅุถุงูุฉ ูุฑุงูุจุฉ ููุตูุฉ:** ุฑุณุงุฆู Console ููุตูุฉ ูุชุชุจุน ุงูุนูููุงุช
4. **ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก:** ูุญุงููุงุช ูุชุนุฏุฏุฉ ูุญููู ุจุฏููุฉ

ุงููุธุงู ุงูุขู ุฃูุซุฑ ููุฉ ูููููู ุงูุชุนุงูู ูุน ูุฎุชูู ุงูุณููุงุฑูููุงุช ูุงููุดุงูู ุงููุญุชููุฉ. 
