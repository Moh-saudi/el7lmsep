# ุชูุฑูุฑ ุฅุตูุงุญ ูุธุงู Callbacks ุฌูุฏูุง

## ๐ฏ ุงููุดููุฉ ุงูุฃุตููุฉ

ูุงูุช ุงููุดููุฉ ูู **ูุนุงูุฌุฉ ุงุณุชุฌุงุจุฉ ุงูุจูู** ุจุนุฏ ุฅุฏุฎุงู ุฑูุฒ ุงูุชุญูู ูู ุฌูุฏูุง. ุงููุธุงู ูุงู ูุนูู ุญุชู ูุตูู ุฑุณุงูุฉ ุงูุจููุ ููู ุจุนุฏ ุฅุฏุฎุงู ุฑูุฒ ุงูุชุญูู ุจุดูู ุตุญูุญุ ูุงูุช ุชุธูุฑ ุฑุณุงูุฉ "ููุงู ูุดููุฉ ูู ุงูุฏูุน".

## ๐ ุงูุณุจุจ ุงูุฌุฐุฑู

ุงููุดููุฉ ูู ุชูู ูู **ุงูููุงุชูุญ ุฃู ุงูุชูููู**ุ ุจู ูู:
1. **ุนุฏู ูุนุงูุฌุฉ ุงูู callbacks ุจุดูู ุตุญูุญ** ูู ุฌูุฏูุง
2. **ุนุฏู ุญูุธ ุจูุงูุงุช ุงูุฏูุน** ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
3. **ุนุฏู ุนุฑุถ ุฑุณุงุฆู ุงููุฌุงุญ/ุงููุดู** ุงูููุงุณุจุฉ

## ๐๏ธ ุงูุญู ุงููุทุจู

### 1. ุฅูุดุงุก Webhook Handler ูุญุณู
**ุงูููู:** `src/app/api/geidea/callback/route.ts`

**ุงูููุฒุงุช:**
- โ ูุนุงูุฌุฉ ุฌููุน ุฃููุงุน ุงูู callbacks (ูุฌุงุญุ ูุดูุ ุฅูุบุงุก)
- โ ุงูุชุญูู ูู ุตุญุฉ ุงูุชูููุน
- โ ุญูุธ ุงูุจูุงูุงุช ูู Firebase
- โ ุญูุธ ุงูุจูุงูุงุช ูู localStorage ูู fallback
- โ ุชุณุฌูู ููุตู ููุฃุญุฏุงุซ

### 2. ุชุญุฏูุซ ูููู ุงูุฏูุน
**ุงูููู:** `src/components/GeideaPaymentModal.tsx`

**ุงูุชุญุณููุงุช:**
- โ ูุนุงูุฌุฉ ูุญุณูุฉ ููู callbacks
- โ ุญูุธ ุจูุงูุงุช ุงูุฏูุน ูู localStorage
- โ ุฑุณุงุฆู ูุฌุงุญ/ูุดู ูุญุณูุฉ
- โ ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก

### 3. ุฅูุดุงุก ุตูุญุฉ ูุฌุงุญ ุงูุฏูุน
**ุงูููู:** `src/app/payment/success/page.tsx`

**ุงูููุฒุงุช:**
- โ ุนุฑุถ ุญุงูุฉ ุงูุฏูุน ุจุดูู ูุงุถุญ
- โ ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ูู URL parameters
- โ ูุฑุงุกุฉ ุงูุจูุงูุงุช ูู localStorage
- โ ูุงุฌูุฉ ูุณุชุฎุฏู ูุญุณูุฉ

## ๐ ุชุฏูู ุงูุนูู ุงูุฌุฏูุฏ

```
1. ุงููุณุชุฎุฏู ูููู ุงูุฏูุน ุนูู ุฌูุฏูุง
   โ
2. ุฌูุฏูุง ุชุฑุณู callback ุฅูู /api/geidea/callback
   โ
3. ูุนุงูุฌ ุงูู callback ูุนุงูุฌ ุงูุงุณุชุฌุงุจุฉ
   โ
4. ุญูุธ ุจูุงูุงุช ุงูุฏูุน ูู Firebase + localStorage
   โ
5. ุชูุฌูู ุงููุณุชุฎุฏู ุฅูู /payment/success
   โ
6. ุนุฑุถ ุญุงูุฉ ุงูุฏูุน ูููุณุชุฎุฏู
```

## ๐ฏ ุฃููุงุน ุงูู Callbacks ุงููุฏุนููุฉ

### โ ูุฌุงุญ ุงูุฏูุน (responseCode: '000')
- ุนุฑุถ ุฑุณุงูุฉ ูุฌุงุญ
- ุญูุธ ุงูุจูุงูุงุช ูู Firebase
- ุญูุธ ุงูุจูุงูุงุช ูู localStorage
- ุชูุฌูู ูุตูุญุฉ ุงููุฌุงุญ

### โ ูุดู ุงูุฏูุน (responseCode: '110')
- ุนุฑุถ ุฑุณุงูุฉ ุฎุทุฃ
- ุญูุธ ุจูุงูุงุช ุงูุฎุทุฃ
- ุชูุฌูู ูุตูุญุฉ ุงููุดู

### ๐ซ ุฅูุบุงุก ุงูุฏูุน (responseCode: '999')
- ุนุฑุถ ุฑุณุงูุฉ ุฅูุบุงุก
- ุญูุธ ุจูุงูุงุช ุงูุฅูุบุงุก
- ุชูุฌูู ูุตูุญุฉ ุงูุฅูุบุงุก

## ๐ง ุงููููุงุช ุงููุญุฏุซุฉ

1. **`src/app/api/geidea/callback/route.ts`** - ูุนุงูุฌ ุงูู webhook
2. **`src/components/GeideaPaymentModal.tsx`** - ูููู ุงูุฏูุน
3. **`src/app/payment/success/page.tsx`** - ุตูุญุฉ ุงููุฌุงุญ
4. **`scripts/test-geidea-callbacks.js`** - ุณูุฑูุจุช ุงูุงุฎุชุจุงุฑ

## ๐ ููููุฉ ุงูุงุฎุชุจุงุฑ

### 1. ุงุฎุชุจุงุฑ ุงูุฏูุน ุงูุญูููู
```bash
# ุชุดุบูู ุงูุณูุฑูุฑ
npm run dev

# ูุชุญ ุงููุชุตูุญ
http://localhost:3000/dashboard/club/bulk-payment
```

### 2. ูุฑุงูุจุฉ ุงูู Callbacks
- ูุชุญ Developer Tools
- ูุฑุงูุจุฉ Console ููุฑุณุงุฆู
- ูุฑุงูุจุฉ Network tab ููู API calls
- ูุญุต localStorage ููุจูุงูุงุช ุงููุญููุธุฉ

### 3. ุงุฎุชุจุงุฑ ุงูู Webhook
```bash
# ุงุฎุชุจุงุฑ ุงูู endpoint
curl -X GET http://localhost:3000/api/geidea/callback
```

## ๐ ุงููุชุงุฆุฌ ุงููุชููุนุฉ

### ูุจู ุงูุฅุตูุงุญ:
- โ ุฑุณุงูุฉ "ูุดููุฉ ูู ุงูุฏูุน" ุจุนุฏ ุฅุฏุฎุงู ุฑูุฒ ุงูุชุญูู
- โ ุนุฏู ุญูุธ ุจูุงูุงุช ุงูุฏูุน
- โ ุนุฏู ูุนุงูุฌุฉ ุงูู callbacks

### ุจุนุฏ ุงูุฅุตูุงุญ:
- โ ุฑุณุงูุฉ ูุฌุงุญ ูุงุถุญุฉ ุจุนุฏ ุงูุฏูุน
- โ ุญูุธ ุงูุจูุงูุงุช ูู Firebase ู localStorage
- โ ูุนุงูุฌุฉ ุตุญูุญุฉ ูุฌููุน ุฃููุงุน ุงูู callbacks
- โ ูุงุฌูุฉ ูุณุชุฎุฏู ูุญุณูุฉ

## ๐ ูุนูููุงุช ุงูุชุทููุฑ

### ูุฑุงูุจุฉ ุงูู Logs:
```javascript
// ูู Console ุงููุชุตูุญ
console.log('๐ [Geidea] Payment successful:', data);
console.log('โ [Geidea] Payment error:', data);
console.log('๐ซ [Geidea] Payment cancelled:', data);
```

### ูุญุต ุงูุจูุงูุงุช ุงููุญููุธุฉ:
```javascript
// ูู Console ุงููุชุตูุญ
localStorage.getItem('geidea_payments')
```

### ูุฑุงูุจุฉ Firebase:
- ูุญุต collection `payments` ูู Firebase
- ุงูุชุญูู ูู ุญูุธ ุงูุจูุงูุงุช ุจุดูู ุตุญูุญ

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **ุฌููุน ุงููุฏููุนุงุช ุญููููุฉ** ูู ูุถุน ุงูุฅูุชุงุฌ
2. **ุงุฎุชุจุงุฑ ุจูุจุงูุบ ุตุบูุฑุฉ** ุฃููุงู
3. **ูุฑุงูุจุฉ ุงูู webhook.site** ููุชุทููุฑ
4. **ุงูุชุฃูุฏ ูู ุตุญุฉ ุงูู return URL** ูู ุงูุฅูุชุงุฌ

## ๐ ุงูุฎูุงุตุฉ

ุชู ุฅุตูุงุญ ุงููุดููุฉ ุจุงููุงูู ูู ุฎูุงู:
- โ ูุนุงูุฌุฉ ุตุญูุญุฉ ููู callbacks
- โ ุญูุธ ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ูุงุฌูุฉ ูุณุชุฎุฏู ูุญุณูุฉ
- โ ุฑุณุงุฆู ูุงุถุญุฉ ูููุณุชุฎุฏู

ุงููุธุงู ุงูุขู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ูู ุงูุฅูุชุงุฌ! ๐ 
